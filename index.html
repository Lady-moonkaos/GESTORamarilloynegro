<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestión Documental CAE - Corporate</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">

<style>
:root{
    --negro:#0f1115;
    --gris:#1c1f26;
    --amarillo:#ffd600;
    --texto:#e6e6e6;
}

body{
    margin:0;
    font-family:'Inter',sans-serif;
    background:var(--negro);
    color:var(--texto);
}

header{
    background:var(--gris);
    padding:20px;
    text-align:center;
    font-size:22px;
    font-weight:600;
    letter-spacing:1px;
    border-bottom:2px solid var(--amarillo);
}

.section{
    margin:25px;
    padding:20px;
    background:var(--gris);
    border-radius:12px;
}

.section-title{
    border:2px solid var(--amarillo);
    border-radius:12px;
    padding:10px 15px;
    display:inline-block;
    font-weight:600;
    margin-bottom:15px;
}

button{
    background:var(--amarillo);
    border:none;
    padding:8px 14px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
}

button:hover{
    opacity:0.85;
}

input{
    padding:8px;
    border-radius:8px;
    border:1px solid #333;
    background:#12141a;
    color:white;
}

.doc-item{
    border:1px solid #2c2f36;
    padding:12px;
    margin:10px 0;
    border-radius:10px;
    background:#151821;
}

iframe{
    width:100%;
    height:450px;
    border-radius:8px;
    margin-top:10px;
}

.stats{
    text-align:center;
    margin:20px;
    font-weight:500;
    opacity:0.8;
}

#login{
    display:flex;
    height:100vh;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    background:var(--negro);
}
</style>
</head>

<body>

<div id="login">
<h2>Acceso Plataforma CAE</h2>
<input type="password" id="password" placeholder="Contraseña">
<button onclick="checkLogin()">Acceder</button>
</div>

<div id="app" style="display:none;">

<header>
GESTIÓN DOCUMENTAL CAE – CORPORATE EDITION
</header>

<div class="stats" id="stats"></div>

<div style="text-align:center;margin:20px;">
<input type="text" id="searchBar" placeholder="Buscar por nombre o etiqueta..." onkeyup="renderAll()" style="width:300px;">
</div>

<div id="content"></div>

</div>

<script>

const PASSWORD="AlmuyOsval26.";

function checkLogin(){
    if(document.getElementById("password").value===PASSWORD){
        document.getElementById("login").style.display="none";
        document.getElementById("app").style.display="block";
    }else{
        alert("Acceso denegado");
    }
}

const sections=[
"Marco Normativo PRL",
"RD 171/2004",
"Documentación CAE",
"Plataformas CAE",
"Evaluación de Riesgos",
"Formación",
"Vigilancia de la Salud",
"Accidentes e Incidentes",
"Auditorías PRL",
"Gestión Documental"
];

let library=JSON.parse(localStorage.getItem("corporateLibrary"))||{};
const container=document.getElementById("content");

sections.forEach(sec=>{
    if(!library[sec]) library[sec]=[];

    const div=document.createElement("div");
    div.className="section";
    div.innerHTML=`
    <div class="section-title">${sec} (${library[sec].length} documentos)</div><br>
    <input type="file" accept="application/pdf" multiple onchange="uploadPDF(event,'${sec}')">
    <div id="${sec}"></div>
    `;
    container.appendChild(div);
});

function uploadPDF(event,section){
    const files=event.target.files;
    for(let file of files){
        const reader=new FileReader();
        reader.onload=function(e){
            const tag=prompt("Etiquetas (separadas por coma):");
            library[section].push({
                name:file.name,
                data:e.target.result,
                tags:tag?tag.toLowerCase().split(","):[]
            });
            localStorage.setItem("corporateLibrary",JSON.stringify(library));
            renderAll();
        }
        reader.readAsDataURL(file);
    }
}

function renderAll(){
    const search=document.getElementById("searchBar").value.toLowerCase();
    let total=0;

    sections.forEach(sec=>{
        const secDiv=document.getElementById(sec);
        secDiv.innerHTML="";
        library[sec].forEach((doc,index)=>{
            if(doc.name.toLowerCase().includes(search) || doc.tags.join(",").includes(search)){
                total++;
                const docDiv=document.createElement("div");
                docDiv.className="doc-item";
                docDiv.innerHTML=`
                <strong>${doc.name}</strong><br>
                Etiquetas: ${doc.tags.join(", ")}<br><br>
                <button onclick="downloadPDF('${sec}',${index})">Descargar</button>
                <button onclick="toggleViewer('${sec}',${index})">Ver PDF</button>
                <div id="viewer-${sec}-${index}" style="display:none;">
                <iframe src="${doc.data}"></iframe>
                </div>
                `;
                secDiv.appendChild(docDiv);
            }
        });
    });

    document.getElementById("stats").innerHTML="Total documentos almacenados: "+total;
}

function downloadPDF(section,index){
    const link=document.createElement("a");
    link.href=library[section][index].data;
    link.download=library[section][index].name;
    link.click();
}

function toggleViewer(section,index){
    const viewer=document.getElementById(`viewer-${section}-${index}`);
    viewer.style.display=viewer.style.display==="none"?"block":"none";
}

renderAll();

</script>

</body>
</html>

